<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    // Initialize the map without a fixed view; we'll fit to geocoded bounds
    var map = L.map('map');

    // OSM standard tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // Query Nominatim for "Ph·ªë ·∫©m th·ª±c Vƒ©nh Kh√°nh, Qu·∫≠n 4, H·ªì Ch√≠ Minh"
    var query = 'Ph·ªë ·∫©m th·ª±c Vƒ©nh Kh√°nh, Qu·∫≠n 4, H·ªì Ch√≠ Minh, Vi·ªát Nam';
    var url = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + encodeURIComponent(query);

    fetch(url, { headers: { 'Accept': 'application/json' } })
      .then(function(r) { return r.json(); })
      .then(function(results) {
        if (results && results.length > 0) {
          var item = results[0];
          var lat = parseFloat(item.lat);
          var lon = parseFloat(item.lon);
          // Fit to bounding box when available
          if (item.boundingbox && item.boundingbox.length === 4) {
            var south = parseFloat(item.boundingbox[0]);
            var north = parseFloat(item.boundingbox[1]);
            var west  = parseFloat(item.boundingbox[2]);
            var east  = parseFloat(item.boundingbox[3]);
            var bounds = L.latLngBounds([[south, west], [north, east]]);
            map.fitBounds(bounds, { padding: [20, 20] });
          } else {
            map.setView([lat, lon], 17);
          }

          L.marker([lat, lon])
            .addTo(map)
            .bindPopup('Ph·ªë ·∫©m th·ª±c Vƒ©nh Kh√°nh');
        } else {
          // Fallback approximate center (Qu·∫≠n 4 near Vƒ©nh Kh√°nh)
          var fallback = [10.7578, 106.7053];
          map.setView(fallback, 17);
          L.marker(fallback).addTo(map).bindPopup('Ph·ªë ·∫©m th·ª±c Vƒ©nh Kh√°nh (∆∞·ªõc l∆∞·ª£ng)');
        }
      })
      .catch(function() {
        // Network or parsing error fallback
        var fallback = [10.7578, 106.7053];
        map.setView(fallback, 17);
        L.marker(fallback).addTo(map).bindPopup('Ph·ªë ·∫©m th·ª±c Vƒ©nh Kh√°nh (∆∞·ªõc l∆∞·ª£ng)');
      });
  </script>

<script>
    var map = L.map('map').setView([10.776889, 106.700806], 15);
  
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);
  
    var userMarker = null;
  
    // H√ÄM MAUI G·ªåI
    function showUserLocation(lat, lng) {
      if (userMarker) {
        map.removeLayer(userMarker);
      }
  
      userMarker = L.marker([lat, lng])
        .addTo(map)
        .bindPopup("üìç V·ªã tr√≠ c·ªßa b·∫°n")
        .openPopup();
  
      map.setView([lat, lng], 16);
    }
  </script>
  
</body>
</html>
